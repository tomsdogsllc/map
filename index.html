<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tom's Dogs â€“ Service Area</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Nunito:300,400,500,600,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
:root{
  --green:#315532;
  --sage:#5E7C60;
  --cream:#FFF6E5;
  --cream2:#F7F4ED;
  --orange:#D9772A;
  --deep:#253F26;
  --panel: rgba(15,27,18,0.58);
  --panelBorder: rgba(255,246,229,0.18);
  --outline: rgba(94,124,96,0.55);
  --shadow1: rgba(37,63,38,0.22);
  --shadow2: rgba(37,63,38,0.12);
}

html,body{
  height:100%;
  margin:0;
  background:transparent;
  font-family:"Nunito",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  overflow:hidden;
}

.shell{
  position:relative;
  height:100%;
  width:100%;
  border-radius:18px;
  overflow:hidden;
  border:1px solid var(--outline);
  background:rgba(37,63,38,0.18);
  box-shadow:0 10px 24px var(--shadow1),0 2px 8px var(--shadow2);
}

#map{ position:absolute; inset:0; }

.badge{
  position:absolute;
  left:12px;
  bottom:12px;
  z-index:600;
  padding:8px 12px;
  border-radius:999px;
  background:var(--panel);
  border:1px solid var(--panelBorder);
  color:var(--cream2);
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
  backdrop-filter:blur(6px);
  user-select:none;
}

.btn{
  position:absolute;
  right:12px;
  bottom:12px;
  z-index:600;
  padding:9px 14px;
  border-radius:999px;
  background:rgba(49,85,50,.65);
  border:1px solid rgba(255,246,229,.18);
  color:var(--cream2);
  text-decoration:none;
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
  transition:transform 140ms ease,background 160ms ease;
}

.btn:hover{
  transform:translateY(-1px);
  background:rgba(49,85,50,.82);
}
</style>
</head>

<body>
<div class="shell">
  <div id="map"></div>
  <div class="badge">New London County</div>
  <a class="btn" target="_blank" rel="noopener" href="https://www.google.com/maps?q=New+London+County,+CT">
    Open in Google Maps
  </a>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const GEOJSON =
  'https://geodata.ct.gov/api/download/v1/items/851b3129c0eb4a269c58dbca69072227/geojson?layers=1';

/* Strong county detection */
function isNewLondonCounty(props){
  if (!props) return false;

  const values = Object.values(props)
    .filter(v => typeof v === 'string')
    .map(v => v.toLowerCase());

  return values.some(v =>
    v === 'new london county' ||
    v === 'new london' ||
    v.includes('new london county')
  );
}

/* Init map */
const map = L.map('map',{
  zoomControl:true,
  scrollWheelZoom:false,
  preferCanvas:true
});

/* Basemap */
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{
  maxZoom:18,
  attribution:'&copy; OpenStreetMap &copy; CARTO'
}).addTo(map);

/* Safe CT coastline fallback */
map.setView([41.45,-72.10],10);

/* Iframe sizing hardening */
function stabilize(){
  map.invalidateSize(true);
}
window.addEventListener('load',()=>{
  setTimeout(stabilize,80);
  setTimeout(stabilize,260);
  setTimeout(stabilize,900);
});
window.addEventListener('resize',()=>setTimeout(stabilize,50));

/* County highlight style */
const countyStyle={
  color:'#D9772A',
  weight:2,
  opacity:.95,
  fillColor:'#315532',
  fillOpacity:.30
};

/* Load counties and highlight New London */
fetch(GEOJSON,{mode:'cors'})
  .then(r=>r.json())
  .then(fc=>{
    const target = fc.features.filter(f=>isNewLondonCounty(f.properties));
    if(!target.length) return;

    const layer = L.geoJSON(target,{style:countyStyle}).addTo(map);

    setTimeout(()=>{
      map.invalidateSize(true);
      map.fitBounds(layer.getBounds(),{padding:[20,20],animate:false});
    },140);
  })
  .catch(()=>{});
</script>
</body>
</html>
